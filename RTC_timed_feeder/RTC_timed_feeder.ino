#include "arduino_secrets.h"

/*Feeds fish on timerby Jeremy Smith4/11*/#include <DS3231.h>#include <Wire.h>#include <Servo.h>// setup RTCDS3231 clock;byte year;byte month;byte date;byte dow;byte hour;byte minute;byte second;bool century = false;bool h12Flag;bool pmFlag;// Potentiometer (unusued, for future inputs)int potPin = A0;int potVal;// Servo object and positionServo turningServo;int servoPin = 9;int servoPos = 0;int getFoodPos = 128;int dropFoodPos = 58;// For scheduled feedingbyte fiveSec;bool moveToDropFood = false;// Interruptvolatile boolean feedFishFlag = false;  // volatile as interrupts change itint interruptPin = 2;/***************************************************************************************************** * Setup *  - Open Serial and Wire connection *  - Explain to the user how to use the program *****************************************************************************************************/void setup() {  // Start the serial port  Serial.begin(9600);  // Start the I2C interface  Wire.begin();  // Setup IO  pinMode(potPin, INPUT);  pinMode(LED_BUILTIN, OUTPUT);  digitalWrite(LED_BUILTIN, LOW);    // pinMode(interruptPin, INPUT_PULLUP);  # Using physical pull down  attachInterrupt(digitalPinToInterrupt(interruptPin),feedFish,RISING);    turningServo.attach(servoPin);  // attaches the servo on pin 9 to the servo object  // turningServo.write(getFoodPos);  // This now dictated by time}/***************************************************************************************************** * Loop *  - Each time we receive the time correction on the Serial *  - Set the clock of the DS3231 *  - Echo the value from the DS3231 during 5 seconds *****************************************************************************************************/void loop() {  // Print Times  // year = clock.getYear();  // month = clock.getMonth(century);  // date = clock.getDate();  hour = clock.getHour(h12Flag, pmFlag);  minute = clock.getMinute();  second = clock.getSecond();  // Serial.println("Date: " + (String)(year)+"-"+(String)(month)+"-"+(String)(date)+" "+(String)(hour)+":"+(String)(minute)+":"+(String)(second));    // Move servo according to hour  adjustServoWithTime(hour, minute, second);    // // Move Servo With pin  // potVal = analogRead(potPin);  // servoPos = map(potVal, 0, 1023, 30, 150);  // 0,180 for max server angles  // turningServo.write(servoPos);    // Feed if button interrupt pressed  if (feedFishFlag) {    digitalWrite(LED_BUILTIN, HIGH);    turningServo.write(getFoodPos);    delay(500);    turningServo.write(dropFoodPos);    delay(500);    feedFishFlag = false;    digitalWrite(LED_BUILTIN, LOW);  }    // Serial.println("Pot: " + (String)(potVal) + " Ser: " + (String)(servoPos));  delay(1000);}void feedFish() {    feedFishFlag = true;}void adjustServoWithTime(byte hr, byte min, byte sec){  // // Test Get food every 20s  // moveToDropFood = ((sec >= 0 && sec < 10) || (sec >= 20 && sec < 30) || (sec >= 40 && sec < 50));  // Feed at 9am, 12am, 1600 (retrieving more food at 1000, 1300, 1900)  moveToDropFood = ((hr >= 9 && hr < 10) || (hr >= 12 && hr < 13) || (hr >= 15 && hr < 16));  // Serial.println("Hr: "+(String)(hr)+",  Drop Food?: "+(String)(moveToDropFood));  if(moveToDropFood){    turningServo.write(dropFoodPos);  } else {    turningServo.write(getFoodPos);  }}